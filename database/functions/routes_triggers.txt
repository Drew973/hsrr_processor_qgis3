--trigger function to call process_sec on new row of routes
CREATE OR REPLACE FUNCTION call_process_sec()
  RETURNS TRIGGER 
  LANGUAGE PLPGSQL
  AS
$$
BEGIN
	perform process_sec(new.sec,new.reverse,new.xsp);
	RETURN NEW;
END;
$$
;

--trigger function to call process_sec on deleted row of routes
CREATE OR REPLACE FUNCTION call_process_sec_on_old()
  RETURNS TRIGGER 
  LANGUAGE PLPGSQL
  AS
$$
BEGIN
	perform process_sec(old.sec,old.reverse,old.xsp);
	RETURN OLD;
END;
$$
;


drop trigger if exists routes_insert on routes;
CREATE TRIGGER routes_insert AFTER INSERT ON routes
FOR EACH ROW EXECUTE PROCEDURE call_process_sec();

drop trigger if exists routes_update on routes;
CREATE TRIGGER routes_update AFTER update ON routes
FOR EACH ROW EXECUTE PROCEDURE call_process_sec();

drop trigger if exists routes_delete on routes;
CREATE TRIGGER routes_delete AFTER delete ON routes
FOR EACH ROW EXECUTE PROCEDURE call_process_sec_on_old();